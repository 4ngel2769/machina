services:
  machina:
    build:
      context: .
      dockerfile: Dockerfile
    image: machina:local
    container_name: machina
    restart: unless-stopped
    env_file:
      - .env
    environment:
      NODE_ENV: production
      LIBVIRT_DEFAULT_URI: ${LIBVIRT_DEFAULT_URI:-qemu+unix:///system?socket=/var/run/libvirt/libvirt-sock}
    ports:
      - "3000:3000"
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
      - /var/run/docker.sock:/var/run/docker.sock
      - /var/run/libvirt/libvirt-sock:/var/run/libvirt/libvirt-sock
    group_add:
      - "${LIBVIRT_GID:-0}"
      - "${DOCKER_GID:-0}"
